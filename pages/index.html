<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test</title>
</head>
<body>
  <div>
     <span id="passcode" style="color: blueviolet; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
     font: 300"></span>
    <button id="btn" style="background-color: brown;font-size: large;
    border: dashed; ">copy passcode</button>
  </div>
  <span id="timer" style="color: brown; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;"></span>

  <script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const token = urlParams.get('token')

    let passcodeEL = document.getElementById("passcode")
    let timerEL = document.getElementById("timer")
    let btnEL = document.getElementById("btn")

    const socket = new WebSocket('wss://ancient-lake-5541.fly.dev');
    socket.addEventListener('open', (event) => {
      if(token) socket.send(token);
    });

    if(token) {
      let count = 30
      let int = setInterval(() => {
        count--
        timerEL.innerHTML = count
      }, 1000);

      socket.addEventListener('message', (event) => {
        passcodeEL.innerHTML = event.data
        count = 30
      });

      const copyContent = async () => {
        let text = passcodeEL.innerHTML
        try {
          await navigator.clipboard.writeText(text);
          btnEL.innerHTML = 'Copied successfully'
        } catch (err) {
          console.error('Failed to copy: ', err);
        }
      }

      btnEL.addEventListener('click', copyContent)
    } else {
      passcodeEL.innerHTML = 'Invalid token'
      btnEL.style.display = 'none'
    }
  </script>
</body>
</html>